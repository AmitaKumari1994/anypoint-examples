<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:scripting="http://www.mulesoft.org/schema/mule/scripting"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/scripting http://www.mulesoft.org/schema/mule/scripting/current/mule-scripting.xsd
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="test-suite2.xml" />
	<munit:test name="test-cache-scope-with-salesforce-contacts-flow" description="Test" doc:id="f1d44ae8-a445-43df-b8e1-93dbf6fd3388" >
		<munit:enable-flow-sources>
	        <munit:enable-flow-source value="cache-scope-with-salesforce-contactsFlow"/>
    	</munit:enable-flow-sources>
		<munit:execution>
			<set-payload value='#[""]' doc:name="Reset Payload" doc:id="e9e954c1-d11b-450d-8d70-6ff37f1e0697" />
			<flow-ref doc:name="call-flow-under-test" doc:id="7f9cd8d1-a2c1-4609-af11-ef17e6f34827" name="cache-scope-with-salesforce-contactsFlow"/>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-that doc:name="Assert that body isn't empty" doc:id="7a5395bc-a858-4898-aaea-d23850d83f0c" is="#[MunitTools::notNullValue()]" expression="#[payload]" message="Body is empty!"/>
			<munit-tools:verify-call doc:name="Verify Salesforce connector was used to get data" doc:id="e6b7858f-cf7c-4821-9387-d1769b87adba" processor="salesforce:query" times="1"/>
			<set-variable value="#[payload]" doc:name="Store response body to variable" doc:id="8450918d-9e91-48c0-9e85-ed9b1760013e" variableName="responseBody" mimeType="application/json"/>
			<set-payload value='#[""]' doc:name="Reset Payload" doc:id="42755a3b-5ad0-4d0e-a638-b0e50c48346b" />
			<flow-ref doc:name="Call-flow-under-test-again" doc:id="be37ca57-778d-4c37-a9ee-5db4139e68c7" name="cache-scope-with-salesforce-contactsFlow" />
			<munit-tools:assert-that doc:name="Assert that response body is the same as before" doc:id="dfc38c56-5a7c-454a-8253-bdc7c0fc57df" expression="#[payload]" is="#[MunitTools::equalTo(vars.responseBody)]" message="Response body does not match the one from previous request!"/>
			<munit-tools:verify-call doc:name="Verify the SFDC connector was used only once" doc:id="aa1f3100-67d6-4f0b-83f6-8400699c4f6b" processor="salesforce:query" times="1"/>
			<set-payload value='#[""]' doc:name="Reset Payload" doc:id="7d978dc5-be5d-4cbc-b439-e244b7d3226b" />
			<flow-ref doc:name="call-flow-under-test-last-time" doc:id="cf75d075-44e9-413c-a184-1d21dcf04e76" name="cache-scope-with-salesforce-contactsFlow" />
			<munit-tools:assert-that doc:name="Assert that response body is the same as before" doc:id="dfc38c56-5a7c-454a-8253-bdc7c0fc57df" expression="#[payload]" is="#[MunitTools::equalTo(vars.responseBody)]" message="Response body does not match the one from previous request!"/>
			<munit-tools:verify-call doc:name="Verify the SFDC connector was used only once" doc:id="aa1f3100-67d6-4f0b-83f6-8400699c4f6b" processor="salesforce:query" times="1"/>
</munit:validation>
	</munit:test>


</mule>
